/*! Hester Street Collaborative - v1.0.0
 * http://hesterstreet.org/
 * Copyright (c) 2017; * Licensed GPLv2+ */

!function(a){"use strict";var b=a.document,c=!0;if(a.projectFilterData){mapboxgl.accessToken="pk.eyJ1Ijoib2JqZWN0aXZlc3ViamVjdCIsImEiOiJPY25wYWRjIn0.AFZPHessR_DGefRkzPilDA",mapboxgl.supported()||(c=!1),Vue.component("archive-map",{template:'<div id="archive-project-map" class="sidebar-map is-sticky"></div>',props:["projects"],data:function(){return{map:!1,mapCenter:[-73.98270130711586,40.72701126185467],mapZoom:11,scrollMagicController:!1,timeout:!1,previousProject:null}},mounted:function(){this.map=new mapboxgl.Map({container:"archive-project-map",style:"mapbox://styles/objectivesubject/cj26w6viz00052ss0boe1o2uf",center:this.mapCenter,zoom:this.mapZoom}),this.map.scrollZoom.disable(),this.map.dragRotate.disable(),this.map.dragPan.disable(),this.map.doubleClickZoom.disable(),this.map.touchZoomRotate.disable(),new Sticky(".sidebar-map",{stickyFor:768,stickyContainer:".section__sidebar"})},watch:{projects:function(a){var b=this;this.scrollMagicController&&this.scrollMagicController.destroy(),this.scrollMagicController=new ScrollMagic.Controller,setTimeout(function(){if(a.length)for(var c=0;a.length>c;c++)b.setupProjectScene(a[c]);else b.resetMap()},100)}},methods:{setupProjectScene:function(a){var c=this,d=b.getElementById(a.slug),e=new ScrollMagic.Scene({triggerElement:d,duration:d.offsetHeight}).addTo(this.scrollMagicController);e.on("enter",function(b){-1==d.className.indexOf("is-active")&&(d.className+=" is-active"),"REVERSE"==b.scrollDirection&&(d.className=d.className.split("is-past").join("")),c.timeout?(clearTimeout(c.timeout),c.timeout=setTimeout(function(){c.moveMapTo(a,c.previousProject)},750)):c.timeout=setTimeout(function(){c.moveMapTo(a,c.previousProject)},0)}),e.on("leave",function(b){c.previousProject=a,d.className=d.className.split("is-active").join(""),"FORWARD"==b.scrollDirection&&(d.className+=" is-past")})},moveMapTo:function(a,b){var c,d,e={maxZoom:12,padding:{top:100,bottom:100,left:20,right:20}},f=a.geojson;if(f){if(c=JSON.parse(f),this.updateSource("project-features",c),this.updateLayers("project-features"),b){var g=b.geojson,h=JSON.parse(g),i=turf.center(h),j=turf.center(c);turf.distance(j,i)>50&&(e.linear=!0)}d=turf.extent(c),this.map.fitBounds(d,e)}},resetMap:function(){this.map.getSource("project-features")&&this.map.removeSource("project-features"),this.map.getLayer("project-polygons")&&this.map.removeLayer("project-polygons"),this.map.getLayer("project-points")&&this.map.removeLayer("project-points"),this.map.easeTo({center:this.mapCenter,zoom:this.mapZoom})},updateSource:function(a,b){this.map.getSource(a)&&this.map.removeSource(a),this.map.addSource(a,{type:"geojson",data:b})},updateLayers:function(a){this.map.getLayer("project-polygons")&&this.map.removeLayer("project-polygons"),this.map.getLayer("project-points")&&this.map.removeLayer("project-points"),this.map.addLayer({id:"project-polygons",type:"fill",source:a,paint:{"fill-color":"rgba(189,49,159,0.5)","fill-outline-color":"rgba(0,0,0,0)"},filter:["==","$type","Polygon"]}),this.map.addLayer({id:"project-points",type:"symbol",source:a,layout:{"icon-image":"hsc_pin","icon-offset":[0,-20],"icon-size":1,"icon-allow-overlap":!0},paint:{},filter:["==","$type","Point"]}),this.map.addLayer({id:"project-lines",type:"line",source:a,paint:{"line-color":"#BD319F","line-width":2},filter:["in","$type","LineString","Polygon"]})}}}),Vue.component("filter-term",{template:'<li class="list__item filter-group__item" v-bind:class="{ \'is-active\' : active }" v-on:click="select">{{ filterObj.name }}</li>',props:["filterObj","isActive"],data:function(){return{active:this.isActive}},watch:{isActive:function(a){this.active=a}},methods:{select:function(){this.$emit("select")}}}),Vue.component("sort-select",{template:'<div class="sort-select" v-on:click="toggleSelect" ><p class="u-caps">Sort By</p><ul class="u-mt-0"><sort-choice v-on:selectchoice="selectSortChoice(\'alpha_desc\')" v-if=" selectIsOpen || choice == \'alpha_desc\' " value="alpha_desc" name="Alphabetical ⬇︎" ></sort-choice><sort-choice v-on:selectchoice="selectSortChoice(\'alpha_asc\')" v-if=" selectIsOpen || choice == \'alpha_asc\' " value="alpha_asc" name="Alphabetical ⬆︎" ></sort-choice><sort-choice v-on:selectchoice="selectSortChoice(\'date_start_desc\')" v-if=" selectIsOpen || choice == \'date_start_desc\' " value="date_start_desc" name="Date Started ⬇︎" ></sort-choice><sort-choice v-on:selectchoice="selectSortChoice(\'date_start_asc\')" v-if=" selectIsOpen || choice == \'date_start_asc\' " value="date_start_asc" name="Date Started ⬆︎" ></sort-choice><sort-choice v-on:selectchoice="selectSortChoice(\'date_end_desc\')" v-if=" selectIsOpen || choice == \'date_end_desc\' " value="date_end_desc" name="Date Completed ⬇︎" ></sort-choice><sort-choice v-on:selectchoice="selectSortChoice(\'date_end_asc\')" v-if=" selectIsOpen || choice == \'date_end_asc\' " value="date_end_asc" name="Date Completed ⬆︎" ></sort-choice></ul></div>',props:["activeChoice"],data:function(){return{selectIsOpen:!1}},computed:{choice:function(){return this.activeChoice}},methods:{toggleSelect:function(){this.selectIsOpen=!this.selectIsOpen},selectSortChoice:function(a){this.$emit("selectsortchoice",a)}}}),Vue.component("sort-choice",{template:'<li class="u-font-gta-extended u-color-hover-green u-transition-300 u-cursor-pointer" v-on:click="selectChoice" v-html="name"></li>',props:["value","name"],methods:{selectChoice:function(){this.$emit("selectchoice")}}});new Vue({el:"#app",template:"#project-archive-template",data:{loading:!0,error:!1,queryData:{current_page:1,found_posts:0,total_pages:1},currentFilterGroup:"service",currentFilters:{service:[],issue:[],date:!1,status:!1,location:[]},currentSort:"date_start_desc",projectFilterData:projectFilterData,projects:[],mapboxSupported:c},beforeMount:function(){var a=this.$el.getAttribute("data-preload-filters");a&&(a=JSON.parse(a)),this.currentFilters=Object.assign({},this.currentFilters,a)},mounted:function(a){this.getProjects(this.getProjectApiUrl())},watch:{currentSort:function(a){this.sortProjects(a)}},computed:{hasFilters:function(){return!!this.currentFilters.service.length||(!!this.currentFilters.issue.length||(!!this.currentFilters.location.length||(!!this.currentFilters.date||(!!this.currentFilters.status||void 0))))}},methods:{getProjectApiUrl:function(a){function b(a,b){var c=[];return a.length?(a.forEach(function(a,b){c.push(a)}),c.join("+")):b}a=a||1;var c=b(this.currentFilters.service,"all_services"),d=b(this.currentFilters.issue,"all_issues"),e=b(this.currentFilters.location,"all_locations"),f="all_dates",g="all_status";if(this.currentFilters.date){f=(new Date).getTime()/1e3-this.currentFilters.date.seconds}return this.currentFilters.status&&(g=this.currentFilters.status.slug),[f,c,d,g,e,a].join("/")},toggleFilterGroup:function(a,b){this.currentFilterGroup=a.slug},toggleFilter:function(a,b){var c=this.currentFilters[a.taxonomy].indexOf(a.slug);c>-1?this.currentFilters[a.taxonomy].splice(c,1):this.currentFilters[a.taxonomy].push(a.slug),this.loading=!0,this.getProjects(this.getProjectApiUrl())},toggleDate:function(a,b){this.currentFilters.date.seconds==a.seconds?this.currentFilters.date=!1:this.currentFilters.date=a,this.loading=!0,this.getProjects(this.getProjectApiUrl())},toggleStatus:function(a,b){this.currentFilters.status.slug==a.slug?this.currentFilters.status=!1:this.currentFilters.status=a,this.loading=!0,this.getProjects(this.getProjectApiUrl())},resetFilters:function(){this.currentFilters={service:[],issue:[],date:!1,status:!1,location:[]},this.loading=!0,this.getProjects(this.getProjectApiUrl())},toggleSort:function(a){this.currentSort!==a&&(this.currentSort=a)},sortProjects:function(a){if(this.projects.length)switch(a){case"alpha_desc":this.projects.sort(function(a,b){var c=a.title.toUpperCase(),d=b.title.toUpperCase();return c>d?-1:c<d?1:0});break;case"alpha_asc":this.projects.sort(function(a,b){var c=a.title.toUpperCase(),d=b.title.toUpperCase();return c<d?-1:c>d?1:0});break;case"date_start_desc":this.projects.sort(function(a,b){return a.begin_date>b.begin_date?-1:a.begin_date<b.begin_date?1:0});break;case"date_start_asc":this.projects.sort(function(a,b){return a.begin_date<b.begin_date?-1:a.begin_date>b.begin_date?1:0});break;case"date_end_desc":this.projects.sort(function(a,b){return a.end_date>b.end_date?-1:a.end_date<b.end_date?1:0});break;case"date_end_asc":this.projects.sort(function(a,b){return a.end_date<b.end_date?-1:a.end_date>b.end_date?1:0});break;default:return}},getProjects:function(a,b,c){console.log(a);var d=this;d.loading=!0,d.error=!1,b=b||this.currentSort,fetch(HSC.api+"hsc-projects/"+a).then(function(a){return a.json()}).then(function(a){d.queryData=a.query,d.projects=c?d.projects.concat(a.posts):a.posts,d.loading=!1,d.sortProjects(b)}).catch(function(a){d.loading=!1,d.error=!0,console.log("Project fetch failed",a)})},getMoreProjects:function(){var a=this.getProjectApiUrl(this.queryData.current_page+1);this.getProjects(a,this.currentSort,"append")}}})}}(this);
//# sourceMappingURL=archive-project.min.js.map