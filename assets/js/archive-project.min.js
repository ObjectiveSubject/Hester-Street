/*! Hester Street Collaborative - v1.0.0
 * http://hesterstreet.org/
 * Copyright (c) 2017; * Licensed GPLv2+ */

!function(a){"use strict";var b=a.document;if(a.projectFilterData){mapboxgl.accessToken="pk.eyJ1Ijoib2JqZWN0aXZlc3ViamVjdCIsImEiOiJPY25wYWRjIn0.AFZPHessR_DGefRkzPilDA",Vue.component("archive-map",{template:'<div id="archive-project-map" class="sidebar-map"></div>',props:["projects"],data:function(){return{map:!1,scrollMagicController:!1}},mounted:function(){this.map=new mapboxgl.Map({container:"archive-project-map",style:"mapbox://styles/objectivesubject/cj26w6viz00052ss0boe1o2uf",center:[-73.98270130711586,40.72701126185467],zoom:11}),this.map.scrollZoom.disable(),this.map.dragRotate.disable(),this.map.dragPan.disable(),this.map.doubleClickZoom.disable(),this.map.touchZoomRotate.disable()},watch:{projects:function(a){var b=this;this.scrollMagicController&&this.scrollMagicController.destroy(),this.scrollMagicController=new ScrollMagic.Controller,setTimeout(function(){for(var c=0;a.length>c;c++)b.setupProjectScene(a[c])},100)}},methods:{setupProjectScene:function(a){var c=this,d=b.getElementById(a.slug),e=new ScrollMagic.Scene({triggerElement:d,duration:d.offsetHeight}).addTo(this.scrollMagicController);e.on("enter",function(b){-1==d.className.indexOf("is-active")&&(d.className+=" is-active"),c.moveMapTo(a)}),e.on("leave",function(a){d.className=d.className.split("is-active").join("")})},moveMapTo:function(a){var b=a.geojson;if(b){var c=JSON.parse(b);this.updateSource("project-features",c),this.updateLayers("project-features");var d=turf.extent(c);this.map.fitBounds(d,{maxZoom:14,padding:{top:40,bottom:20,left:20,right:20}})}},updateSource:function(a,b){this.map.getSource(a)&&this.map.removeSource(a),this.map.addSource(a,{type:"geojson",data:b})},updateLayers:function(a){this.map.getLayer("project-polygons")&&this.map.removeLayer("project-polygons"),this.map.getLayer("project-points")&&this.map.removeLayer("project-points"),this.map.addLayer({id:"project-polygons",type:"fill",source:a,paint:{"fill-color":"#BD319F","fill-opacity":.7,"fill-outline-color":"rgba(0,0,0,0)"},filter:["==","$type","Polygon"]}),this.map.addLayer({id:"project-points",type:"symbol",source:a,layout:{"icon-image":"hsc_pin","icon-offset":[0,-20],"icon-size":1,"icon-allow-overlap":!0},paint:{},filter:["==","$type","Point"]})}}}),Vue.component("filter-term",{template:'<li class="list__item filter-group__item" v-bind:class="{ \'is-active\' : active }" v-on:click="select">{{ filterObj.name }}</li>',props:["filterObj","isActive"],data:function(){return{active:this.isActive}},methods:{select:function(){this.active?this.active=!1:this.active=!0,this.$emit("select")}}});new Vue({el:"#project-archive-app",data:{currentFilterGroup:"service",currentFilters:{service:[],issue:[],date:!1,status:"",location:[]},projectFilterData:projectFilterData,projects:[]},mounted:function(a){this.getProjects(this.projectApiUrl)},computed:{projectApiUrl:function(){function a(a,b){var c=[];return a.length?(a.forEach(function(a,b){c.push(a)}),c.join("+")):b}var b=a(this.currentFilters.service,"all_services"),c=a(this.currentFilters.issue,"all_issues"),d=a(this.currentFilters.location,"all_locations"),e="all_dates",f="all_status";if(this.currentFilters.date){e=(new Date).getTime()/1e3-this.currentFilters.date.seconds}return this.currentFilters.status&&(f=this.currentFilters.status.slug),[e,b,c,f,d].join("/")}},methods:{toggleFilterGroup:function(a,b){this.currentFilterGroup=a.slug},toggleFilter:function(a,b){var c=this.currentFilters[a.taxonomy].indexOf(a.slug);c>-1?this.currentFilters[a.taxonomy].splice(c,1):this.currentFilters[a.taxonomy].push(a.slug),this.getProjects(this.projectApiUrl)},toggleDate:function(a,b){this.currentFilters.date.seconds==a.seconds?this.currentFilters.date=!1:this.currentFilters.date=a,this.getProjects(this.projectApiUrl)},getProjects:function(a){var b=this;fetch(HSC.api+"/projects/"+a).then(function(a){return a.json()}).then(function(a){b.projects=a}).catch(function(a){console.log("Project fetch failed",a)})}}})}}(this);
//# sourceMappingURL=archive-project.min.js.map