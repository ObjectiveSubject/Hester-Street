/*! Hester Street Collaborative - v1.0.0
 * http://hesterstreet.org/
 * Copyright (c) 2017; * Licensed GPLv2+ */

!function(a){"use strict";var b=a.document;if(a.projectFilterData){mapboxgl.accessToken="pk.eyJ1Ijoib2JqZWN0aXZlc3ViamVjdCIsImEiOiJPY25wYWRjIn0.AFZPHessR_DGefRkzPilDA",Vue.component("archive-map",{template:'<div id="archive-project-map" class="sidebar-map"></div>',props:["projects"],data:function(){return{map:!1,scrollMagicController:!1}},mounted:function(){this.map=new mapboxgl.Map({container:"archive-project-map",style:"mapbox://styles/objectivesubject/cj21fglc3004t2sp199kzw03v",center:[-73.98270130711586,40.72701126185467],zoom:11}),this.map.scrollZoom.disable(),this.map.dragRotate.disable(),this.map.dragPan.disable(),this.map.doubleClickZoom.disable(),this.map.touchZoomRotate.disable()},watch:{projects:function(a){console.log(a);var b=this;this.scrollMagicController&&this.scrollMagicController.destroy(),this.scrollMagicController=new ScrollMagic.Controller,setTimeout(function(){for(var c=0;a.length>c;c++)b.setupProjectScene(a[c])},100)}},methods:{setupProjectScene:function(a){var c=this,d=b.getElementById(a.slug),e=new ScrollMagic.Scene({triggerElement:d,duration:d.offsetHeight}).addTo(this.scrollMagicController);e.on("enter",function(b){-1==d.className.indexOf("is-active")&&(d.className+=" is-active"),c.moveMapTo(a)}),e.on("leave",function(a){d.className=d.className.split("is-active").join("")})},moveMapTo:function(a){var b=a.geojson;if(b){var c=JSON.parse(b);this.updateSource("project-features",c),this.updateLayers("project-features");var d=turf.extent(c);this.map.fitBounds(d,{maxZoom:14,padding:{top:40,bottom:20,left:20,right:20}})}},updateSource:function(a,b){this.map.getSource(a)&&this.map.removeSource(a),this.map.addSource(a,{type:"geojson",data:b})},updateLayers:function(a){this.map.getLayer("project-polygons")&&this.map.removeLayer("project-polygons"),this.map.getLayer("project-points")&&this.map.removeLayer("project-points"),this.map.addLayer({id:"project-polygons",type:"fill",source:a,paint:{"fill-color":"#BD319F","fill-opacity":.7,"fill-outline-color":"rgba(0,0,0,0)"},filter:["==","$type","Polygon"]}),this.map.addLayer({id:"project-points",type:"symbol",source:a,layout:{"icon-image":"hsc_pin","icon-offset":[0,-20],"icon-size":1,"icon-allow-overlap":!0},paint:{},filter:["==","$type","Point"]})}}});new Vue({el:"#project-archive-app",data:{currentFilterGroup:"services",projectFilterData:projectFilterData,projects:[]},mounted:function(a){this.getProjects()},methods:{toggleFilterGroup:function(a,b){this.currentFilterGroup=a.slug},addFilter:function(a,b){this.projects.shift()},removeFilter:function(a,b){},getProjects:function(a){var b=this,c={startDate:"all_dates",services:"all_services",issues:"all_issues",status:"all_status",locations:"all_locations"};a=Object.assign(c,a),fetch(HSC.api+"/projects/"+[a.startDate,a.services,a.issues,a.status,a.locations].join("/")).then(function(a){return a.json()}).then(function(a){b.projects=a}).catch(function(a){console.log("Project fetch failed",a)})}}})}}(this);
//# sourceMappingURL=archive-project.min.js.map